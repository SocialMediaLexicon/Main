{% extends "social_app/base.html" %}

{% block title %}User profile{% endblock %}

{% block content %}
<br><br><br>
<div class="col-md-8 m-auto">

    <div class="content-section">
        
        <div class="account-img-container">
            <div class="img-cont">
                <img class="rounded-circle account-img mx-auto d-block" src="{{object.profile_pic.url}}" alt="image">
                
            </div>
        </div>
        
		<hr tyle="height:3px;border-width:0;color:gray;background-color:gray">

        <div class="card-body">
            
            <h4 class="card-title text-center">{{object.user.first_name}} {{object.user.last_name}} [{{object.user.username}}]</h4>

			<div class="d-flex flex-row bd-highlight mb-3 justify-content-center">
                <a href="{% url 'login' %}" class="btn btn-success d-flex mb-3 justify-content">Go Back Home</a>
                
                
            </div>


 		<div class="text-center">
            {% if object.user != user %}
                {% if follow %}
                    <form action="{% url 'users:follow-unfollow' %}" method='POST'>
                        {% csrf_token %}
                        <input type="hidden" name="profile_id" value={{object.id}}>
                        <button type="submit" class="btn btn-danger mb-2 w-50">Unfollow</button>
                    </form>
                {% else %}
                    <form action="{% url 'users:follow-unfollow' %}" method='POST'>
                        {% csrf_token %}
                        <input type="hidden" name="profile_id" value={{object.id}}>
                        <button type="submit" class="btn btn-success mb-2 w-50">Follow</button>
                    </form>
                {% endif %}
            {% endif %}

        </div>
        	<hr>


			<div class="m-t-10 p-15 text-center">
				<div class="row">
					<div class="col">
						<span class="h6">Posts</span>
						<p><a class="mr-2" href="#">{{object.profile_posts.count}}</a></p>
					</div>
				
					<div class="col">
						<span class="h6">Followers</span>
						<p style="cursor:pointer; color: blue;" data-contents="{{object.user.following.all}}" data-title="Followers" title="Followers">{{object.user.following.count}}</p>
					</div>
					<div class="col">
						<span class="h6">Following</span>
						<p style="cursor:pointer; color: blue;"  data-contents="{{object.user.profile.following.all}}" data-title="Following" title="Following">{{object.user.profile.following.count}}</p>
					</div>
				</div>
			</div>
    	</div>
	</div>
</div>
<br>


<br>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
		  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		  </button>
		</div>
		<div class="modal-body">
		  ...
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		</div>
	  </div>
	</div>
</div>







{% endblock %}

{% block script %}

	
<script>
	$('#exampleModal').on('show.bs.modal', function (event) {
		var button = $(event.relatedTarget) 
		var mcontents = button.data('contents') 
		var mtitle = button.data('title') 
		
		var modal = $(this)
		var mlist = ""
		var mbody = ""

		if (mtitle === "Followers") {
			mtitle = mtitle + ' ({{object.user.following.count}})'
			{% for fs in object.user.following.all %}
				mlist += `<li class="m-1">
							<a href="{% url 'users:user_profile_details' id=fs.id %}">
								{{fs.user}}
							</a>
						</li>`
			{% endfor %}
			mbody = `<ul>${mlist}</ul>`
		}
		if (mtitle === "Following") {
			mtitle = mtitle + ' ({{object.user.profile.following.count}})'
			{% for fs in object.user.profile.following.all %}
				mlist += `<li class="m-1">
							<a href="{% url 'users:user_profile_details' id=fs.id %}">
								{{fs.user}}
							</a>
						</li>`
			{% endfor %}
			mbody = `<ul>${mlist}</ul>`
		}
		modal.find('.modal-title').text(mtitle)
		modal.find('.modal-body').html(mbody)
	});
</script>
{% endblock %}